# Set up variables for Azure DevOps organization and personal access token
$orgName = "YourAzureDevOpsOrganizationName"
$pat = "YourPersonalAccessToken"

# Set up API URL for getting list of users with Basic + Test Plans license
$url = "https://vssps.dev.azure.com/$orgName/_apis/userentitlements?api-version=6.0-preview.2&$filter=(accessLevel/license/accessLevelBits eq 6)&$expand=extensions"

# Set up header for API request with personal access token
$headers = @{
    Authorization = "Basic $( [Convert]::ToBase64String([Text.Encoding]::ASCII.GetBytes(":$($pat)")) )"
}

# Invoke REST API to get list of users with Basic + Test Plans license
$response = Invoke-RestMethod -Uri $url -Headers $headers

# Filter the list of users to only those who haven't created test plans in the last 30 days
$usersWithoutRecentTestPlans = $response.value | Where-Object { $_.extensions.testManagement.lastUsedDate -lt (Get-Date).AddDays(-30) }

# Output the filtered list of users
Write-Output $usersWithoutRecentTestPlans
